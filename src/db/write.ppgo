import (
    "../proto";
)

public interface CmdWriteProc
{
    public func do_write(client proto.Client, vs VSlot) (failed bool);
}

public func do_write(client proto.Client, cwp CmdWriteProc, hash_tag string)
{
    var id = hash_tag_to_vslot_id(hash_tag);
    with (vslot_write_locks[id])
    {
        var vs = VSlot(id, read_only = false);
        var failed = cwp.do_write(client, vs);
        if (!failed)
        {
            get_db(id).write(vs.snapshot.export_wb());
        }
    }
}
